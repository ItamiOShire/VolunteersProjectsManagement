<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/main-layout.css">
    <link rel="stylesheet" href="/css/volunteer-project-desc.css">
    <title>Strona główna</title>
</head>
<body onload = "loadContent()">

    <header class="header">

        <div class="logo-container">
            <img src="images/logo.png" alt="logo" class="logo">
        </div>

        <nav class="nav-menu">
            <div class="nav-links-container">
                <a href="" class="nav-link">O nas</a>
                <a href="/volunteer/projects" class="nav-link">Projekty</a>
                <a href="" class="nav-link">Organizacje</a>
                <a href="" class="nav-link">Kontakt</a>
            </div>
            <div class="sign-in-up-buttons">
                <a href="/volunteer/profile" class="nav-link">Profil</a>
                <a href="" class="nav-link">Wyloguj</a>
            </div>

        </nav>

    </header>

    <hr class="section-line">

    <main class="main">

        <section class="project-container">

            

        </section>

        <section class="tasks-container">

            <h1>Lista zadań</h1>

            <div class="tasks" id="tasks">

                

            </div>

        </section>
        

    </main>

    <hr class="section-line">

    <footer class="footer">

        <div class="footer-col1"><img src="images/logo2mini.png" alt=""></div>
        <div class="footer-col2">col2</div>
        <div class="footer-col3">col3</div>
        <div class="footer-col4">col4</div>

    </footer>

    <script defer>

        const urlArray = window.location.href.split("/");
        const projectId = urlArray.at(-1);

        async function getProject() {
                
                const root = document.getElementsByClassName("project-container")[0];
                

                try {
                        const response = await fetch('http://localhost:8080/api/project/' + projectId, {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                    });

                    if (response.ok) {
                        const project = await response.json();
                        console.log(project);
                        const imgContainer = document.createElement("div");
                        imgContainer.classList.add("img-container");

                        const img = document.createElement("img");
                        img.src = project.imgPath;
                        img.alt = "zdjecie";
                        img.classList.add("project-img")

                        const textContainer = document.createElement("div");
                        textContainer.classList.add("text-container");

                        const projectTitle = document.createElement("h2");
                        projectTitle.classList.add("project-tittle");
                        projectTitle.innerHTML = project.title;

                        const projectShortDesc = document.createElement("h4");
                        projectShortDesc.classList.add("project-short-desc");
                        projectShortDesc.innerHTML = "Organizacja - " + project.orgName;

                        const projectLongDesc = document.createElement("p");
                        projectLongDesc.classList.add("project-long-desc");
                        projectLongDesc.innerHTML = project.desc;

                        const tagsContainer = document.createElement("div");
                        tagsContainer.classList.add("tags-container");

                        const tags = document.createElement("p");
                        tags.classList.add("tags");

                        for (let x in project.tags) {
                            tags.innerHTML += "[" + project.tags[x].desc + "] ";
                        }

                        imgContainer.appendChild(img);

                        textContainer.appendChild(projectTitle);
                        textContainer.appendChild(projectShortDesc);
                        textContainer.appendChild(projectLongDesc);

                        tagsContainer.appendChild(tags);

                        textContainer.appendChild(tagsContainer);

                        root.appendChild(imgContainer);
                        root.appendChild(textContainer);

                    } else {
                        console.log("blad serwera");
                    }

                } catch (error) {

                    console.log(error);

                }

        }

        async function getTasks() {

            const root = document.getElementById("tasks");

            const priorityArray = [
                "Niski",
                "Umiarkowany",
                "Średni",
                "Wysoki"]

            try {
                    const response = await fetch('http://localhost:8080/api/task/volunteer/project/' + projectId, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                });

                if (response.ok) {

                    const result = await response.json();

                    console.log(result);

                    result.forEach(task => {

                        const div = document.createElement("div");
                        div.classList.add("task");

                        const h2 = document.createElement("h2");
                        h2.classList.add("task-tittle");
                        h2.innerHTML = task["task-title"];

                        const p = document.createElement("p");
                        p.classList.add("task-desc");
                        p.innerHTML = task["task-desc"];

                        const span = document.createElement("span");
                        span.classList.add("priority");
                        span.innerHTML = "Priorytet - " + priorityArray[task.priority - 1] + ", termin - " + task.deadline;

                        div.appendChild(h2);
                        div.appendChild(p);
                        div.appendChild(span);

                        root.appendChild(div);
                        
                    });

                }

            } catch (error) {
                console.log(error);
            }

        }

        function loadContent() {

            getProject();
            getTasks();

        }

    </script>
    
</body>
</html>